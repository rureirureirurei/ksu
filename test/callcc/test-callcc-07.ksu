;100
; Sophisticated backtracking example
(define cont-stack '())

(define (choose opts)
  (call/cc (lambda (k)
      (begin
        (set! cont-stack (pair (pair k (snd opts)) cont-stack))
        (fst opts)
      )
  ))
)


(define count 0)

(define (fail)
  (if (null? cont-stack)
      (print count)
      (let (
             [top (fst cont-stack)]
             [k (fst (fst cont-stack))]
             [remaining (snd (fst cont-stack))])
        (set! cont-stack (snd cont-stack))
        (if (null? remaining)
            (fail)
            (begin
              (set! cont-stack (pair (pair k (snd remaining)) cont-stack))
              (k (fst remaining))
        ))
      )
  )
)

(define (search)
  (let (
        [a (choose (range 1 100))]
        [b (choose (range 1 100))]
        [c (choose (range 1 100))]
       )
        (if (eq? (+ (* b b) (* c c)) (* a a))
            ;(begin (display (list a b c)) (newline) (fail))
            (begin (set! count (+ 1 count)) (fail))
            (fail)
        )
      )
    )

(search)